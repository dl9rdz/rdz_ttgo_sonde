<!DOCTYPE html>
<html>
<head>
  <title>rdzTTGOSonde Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8">
  <link rel="icon" href="data:,">
  <link rel="stylesheet" type="text/css" href="style.css">
  <script>
let matchDarkOS = window.matchMedia('(prefers-color-scheme: dark)').matches;

function setIframes(theme) {
    var i, frames;
    frames = document.getElementsByTagName("iframe");
    for (i = 0; i < frames.length; ++i) {
        var elmnt = frames[i].contentWindow.document.getElementsByTagName("body")[0];
        elmnt.className = theme;
    }
}

function iframeDidLoad() {
    var i, frames;
    frames = document.getElementsByTagName("iframe");
    const currentTheme = localStorage.getItem("theme");
    if (currentTheme) {
        if (currentTheme == 'dark') {
            setIframes("dark-theme");

        } else {
            setIframes("light-theme");
        }
    } else {
        if (matchDarkOS) {
            setIframes("dark-theme");
            // link.innerHTML = 'ðŸŒš';

        } else {
            setIframes("light-theme");
            // link.innerHTML = 'ðŸ”†';
        }
    }
}
  </script>
</head>
<body>
 <div class="wrapper"><div class="header">
  <h2>rdzTTGOSonde Server</h2>
<div class="topnav" id="myTopnav">
	<a href="#" onclick="selTab(event,'QRG')" class="tablinks" id="defaultTab">QRG</a>
	<a href="#" onclick="selTab(event,'WiFi')" class="tablinks">WiFi</a>
	<a href="#" onclick="selTab(event,'Data')" class="tablinks">Data</a>
	<a href="#" onclick="document.location.href='livemap.html'" class="tablinks">LiveMap</a>
	<a href="#" onclick="selTab(event,'Map')" class="tablinks">Map</a>
	<a href="#" onclick="selTab(event,'Config')" class="tablinks">Config</a>
	<a href="#" onclick="selTab(event,'Control')" class="tablinks">Control</a>
	<a href="#" onclick="selTab(event,'About')" class="tablinks">About</a>
	<a href="#" onclick="themeClick()" id="theme-btn" class="btn-toggle">ðŸ”†</a>
	<a href="javascript:void(0);" class="icon" onclick="myFunction()">
		<span class="hamburger"></span>
	</a>
</div>
</div>

<div id="QRG" class="tabcontent" data-src="qrg.html">
	<iframe class="tci" src="" onLoad="iframeDidLoad();"></iframe>
</div>

<div id="WiFi" class="tabcontent" data-src="wifi.html">
	<iframe class="tci" src="" onLoad="iframeDidLoad();"></iframe>
</div>

<div id="Data" class="tabcontent" data-src="status.html">
	<iframe class="tci" src="" onLoad="iframeDidLoad();"></iframe>
</div>

<div id="Map" class="tabcontent" data-src="map.html">
	<iframe class="tci" src="" onLoad="iframeDidLoad();"></iframe>
</div>

<div id="Config" class="tabcontent" data-src="config.html">
	<iframe class="tci" src="" onLoad="iframeDidLoad();"></iframe>
</div>

<div id="Control" class="tabcontent" data-src="control.html">
	<iframe class="tci" src="" onLoad="iframeDidLoad();"></iframe>
</div>

<div id="About" class="tabcontent">
<div class="tci">
   %VERSION_NAME%<br>
   Copyright &copy; 2019-2021 by Hansi Reiser, DL9RDZ<br>
   (version %VERSION_ID%)<br><br>

   <a href="/upd.html">Check for update (requires TTGO internet connection via WiFi)</a><br><br>

   with contributions by Vigor and Xavier (M20 support), 
   <a href="https://github.com/LukePrior">Luke Prior</a> and <a href="https://github.com/oh3bsg">OH3BSG</a> (SondeHub support),
   <a href="https://www.dl2mf.de/" target="_blank">Meinhard Guenther, DL2MF</a>,
   <a href="https://github.com/bazjo">Johannes</a>, <a href="http://www.p1337.synology.me/dokuwiki/doku.php?id=public:wettersonden">Robert Stefanowicz</a>,
   <a href="https://github.com/puspis">Josema</a>, and probably some more people I forgot to mention here.

<br>
   <br>
   Autodetect info: %AUTODETECT_INFO%<br>
   <br>
    RS92 RINEX eph state: %EPHSTATE%<br>
    <br>
    This program is free software; you can redistribute it and/or
    modify it under the terms of the GNU General Public License as
    published by the Free Software Foundation; either version 2 of
    the License, or (at your option) any later version.<br>
    See <a href="https://www.gnu.org/licenses/gpl-2.0.txt">https://www.gnu.org/licenses/gpl-2.0.txt</a>
    for details.
</div>
</div>

</div>
<script>
const link = document.getElementById("theme-btn");
const currentTheme = localStorage.getItem("theme");
if (currentTheme) {
    if (currentTheme == 'dark') {
        document.body.classList.toggle("dark-theme");
        link.innerHTML = 'ðŸ”†';

    } else {
        document.body.classList.toggle("light-theme");
        link.innerHTML = 'ðŸŒš';
    }
} else {
    if (matchDarkOS) {
        link.innerHTML = 'ðŸ”†';

    } else {
        link.innerHTML = 'ðŸŒš';
    }
}


function themeClick() {
    var i, frames;
    frames = document.getElementsByTagName("iframe");

    if (link.innerHTML == 'ðŸŒš') {
        document.body.className = "dark-theme";
        // for (i = 0; i < frames.length; ++i) {
        //     var elmnt = frames[i].contentWindow.document.getElementsByTagName("body")[0];
        //     elmnt.className = "dark-theme";
        // }
        setIframes("dark-theme");
        localStorage.setItem("theme", "dark");
        link.innerHTML = 'ðŸ”†';


    } else {
        document.body.className = "light-theme";
        // for (i = 0; i < frames.length; ++i) {
        //     var elmnt = frames[i].contentWindow.document.getElementsByTagName("body")[0];
        //     elmnt.className = "light-theme";
        // }
        setIframes("light-theme");

        localStorage.setItem("theme", "light");
        link.innerHTML = 'ðŸŒš';

    }

}
function selTab(evt, id) {
	var i, tabcontent, tablinks;
	tabcontent=document.getElementsByClassName("tabcontent");
	for(i=0; i<tabcontent.length; i++) {
		tabcontent[i].style.display = "none";
		var link = tabcontent[i].dataset.src;
		if(link) {
			var iframe = tabcontent[i].getElementsByTagName("iframe")[0];
			iframe.setAttribute("src", "");
		}
	}
	tablinks=document.getElementsByClassName("tablinks");
	for(i=0; i<tablinks.length; i++) {
		tablinks[i].className = tablinks[i].className.replace(" active", "");
	}	
	var act = document.getElementById(id);
	act.style.display = "flex";
	evt.currentTarget.className += " active";
	
	var link = act.dataset.src;
	if(link) {
		var iframe = act.getElementsByTagName("iframe")[0];
		iframe.setAttribute("src", link);
	}
	var x = document.getElementById("myTopnav");
    x.className = "topnav";
}
/* Toggle between adding and removing the "responsive" class to topnav when the user clicks on the icon */
function myFunction() {
  var x = document.getElementById("myTopnav");
  if (x.className === "topnav") {
    x.className += " responsive";
  } else {
    x.className = "topnav";
  }
}
document.getElementById("defaultTab").click();
</script>

</body>
</html>

